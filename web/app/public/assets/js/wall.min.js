var app=angular.module("wall",["angularMoment","nl2br"]).factory("collection",["$q","$http",function(e,t){function n(e){this.path=e}n.prototype.fetch=function(e){return t.get("/wall/feeds").then(function(e){return e.data})},n.prototype.get=function(e){return t.get("/wall/feed/"+e).then(function(e){return e.data})},n.prototype.create=function(e){return e.type="text",t.post("/wall/feed",e).then(function(e){return e.data})},n.prototype.update=function(e,n){return this.get(e).then(function(e){return e=angular.merge(e,n),t.put("/wall/feed/"+e.id,e)}).then(function(e){return e.data})},n.prototype["delete"]=function(e){return t["delete"]("/wall/feed/"+e)};var r={};return function(e){var t=(window.location.hostname+"-"+e).replace(/[\W_]+/g,"_");return r[t]||(r[t]=new n(t)),r[t]}}]).factory("WallFeeds",["collection",function(e){return e("wall-feeds")}]).filter("trustedHtml",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]).factory("Session",["$interval",function(e){var t=(localStorage.getItem("session"),{});return t}]).run(["$rootScope","Session",function(e,t){e.Session=t}]).directive("enterSubmit",function(){return{restrict:"A",link:function(e,t,n){t.bind("keydown",function(t){var r=t.keyCode||t.which;13===r&&t.shiftKey&&(t.preventDefault(),e.$apply(n.enterSubmit))})}}}).factory("User",function(){return user.params=function(){return{name:user.profile.first_name+" "+user.profile.last_name,id:user.id,avatar:user.profile.user_image}},user}).controller("WallController",["WallFeeds","$scope","User","Session","$timeout",function(e,t,n,r,o){Pusher.logToConsole=!1;var i=new Pusher("8ae2990cab38227cd212",{cluster:"ap1",encrypted:!0}),a=i.subscribe(window.location.host);a.bind("wall",function(e){switch(e.action){case"created":t.feeds.unshift(e.data);break;case"updated":var n=t.feeds.filter(function(t){return t.id==e.data.id}).pop();n?t.feeds.splice(t.feeds.indexOf(n),1,e.data):t.feeds.unshift(e.data);break;case"deleted":var n=t.feeds.filter(function(t){return t.id==e.id}).pop();n&&t.feeds.splice(t.feeds.indexOf(n),1)}o(function(){t.$digest()}),console.log(e)}),a.bind("wall-comments",function(e){console.log(e)}),t.feeds=[],t.length=10,e.fetch(t.length).then(function(e){console.log(e),e.forEach(function(e){t.feeds.push(e)})}),t.user=n,t.createFeed=function(){e.create({user:n.params(),content:t.comment,replies:[]}).then(function(e){t.comment=""})},t.doEditFeed=function(t,n){e.update(t.id,{content:n}),r.editComment=null},t.deleteFeed=function(t){confirm("Are you sure you want to delete this?")&&e["delete"](t.id)},t.createReply=function(e,r){var o=e.replies;o.push({user:n.params(),comment:r,createdAt:Date.now(),updatedAt:Date.now()}),e.put({replies:o,updatedAt:Date.now()}),t.reply=""},t.deleteReply=function(e,t){var n=e.replies.indexOf(t);n>-1&&confirm("Are you sure you want to delete this?")&&(e.replies.splice(n,1),e.put({replies:e.replies,updatedAt:Date.now()}))},t.doEditReply=function(e,t,n){var o=e.replies.indexOf(t);o>-1&&(t.comment=n,e.put({replies:e.replies,updatedAt:Date.now()})),r.editReply=null}}]).controller("SidebarController",["$scope","$http",function(e,t){e.entitlements={},t.get("/ajax/entitlement-balances").then(function(t){e.entitlements=t.data})}]);