function nl2br(e,t){var n=t||"undefined"==typeof t?"<br />":"<br>";return(e+"").replace(/(<([^>]+)>)/gi,"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1"+n+"$2")}(function(){function e(){i=!document[t]}var t,n;"undefined"!=typeof document.hidden?(t="hidden",n="visibilitychange"):"undefined"!=typeof document.mozHidden?(t="mozHidden",n="mozvisibilitychange"):"undefined"!=typeof document.msHidden?(t="msHidden",n="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(t="webkitHidden",n="webkitvisibilitychange");var i=(document.getElementById("videoElement"),!0);$('<audio id="soundHandle" style="display:none;"></audio>').attr("src","/alert.mp3")[0];"undefined"==typeof document.addEventListener||"undefined"==typeof document[t]||document.addEventListener(n,e,!1);var o,l=(new(Backbone.View.extend({events:{"keyup textarea":function(e){return 13===e.keyCode&&e.shiftKey&&this.input.val().trim()?(this.submit(),e.preventDefault(),!1):void 0},"click #submit":function(){this.submit()}},submit:function(){$.post("/wall/create-share",{type:"text",content:this.input.val().trim()}),this.reset()},reset:function(){this.input.val("")},initialize:function(){this.input=$("textarea",this.$el),autosize(this.input)}}))({el:"#new-share"}),new Backbone.Collection),s=new Backbone.Collection,a=[],r=4,d=_.debounce(function(e){clearTimeout(o),$("#load-older").button("loading"),r=e,a[0]&&a[0].url&&(a[0].close(),a[0]=null),a[1]&&a[1].url&&(a[1].close(),a[1]=null),o=setTimeout(function(){$("#load-older").text("No Data Found")},1500)},500);d(5);var c=Backbone.View.extend({events:{"click .toggle-more":function(e){this.opened=!0,this.comments.toggleClass("more"),$(e.target).remove()},"click .remove-comment":function(e){var t=$(e.currentTarget);bootbox.confirm("Are you sure you want to remove this comment?",function(e){e&&$.get("/wall/remove-comment/"+t.data("commentid"))})}},collection:s,template:_.template($("#comments-template").text()),templateData:function(){return{comments:this.collection.toJSON().filter(function(e){return e.share_id===this.collectionId}.bind(this)),opened:this.opened}},render:Backbone.VirtualDomRenderer,initialize:function(e){this.opened=!1,this.oldData="{}",this.comments=this.$el.parents(".comments"),this.collectionId=e.collectionId,this.listenTo(this.collection,"all",function(){var e=this.templateData();JSON.stringify(e)!=this.oldData&&(this.oldData=JSON.stringify(e),this.render())}.bind(this)),this.on("virtualdomrenderer:rendered",function(){this.opened||(this.templateData().comments.length>2?this.comments.removeClass("less-than-three-comments"):this.comments.addClass("less-than-three-comments"))}),this.render()}});new(Backbone.View.extend({events:{"click #load-older":function(e){d(r+5)},"keyup textarea":function(e){var t=$(e.currentTarget);return 13===e.keyCode&&e.shiftKey&&t.val().trim()?(this.submit(t.data("feedid"),t.val().trim()),t.val(""),e.preventDefault(),!1):void 0},"click .remove-share":function(e){var t=$(e.currentTarget);bootbox.confirm("Are you sure you want to remove this share?",function(e){e&&$.get("/wall/remove-share/"+t.data("shareid"))})},"click .pin-share":function(e){var t=$(".fa",e.currentTarget);t.hasClass("active")?(t.removeClass("active"),$.get("/wall/unset-pin/"+t.data("shareid"))):(t.addClass("active"),$.get("/wall/set-pin/"+t.data("shareid")))}},submit:function(e,t){$.post("/wall/create-comment/"+e,{comment:t})},collection:l,template:_.template($("#feeds-template").text()),templateData:function(){return{shares:this.collection.toJSON()}},indexes:"",children:[],rendered:null,render:Backbone.VirtualDomRenderer,initialize:function(){this.listenTo(this.collection,"all",function(){JSON.stringify(this.collection.pluck("id"))!==this.indexes&&(this.indexes=JSON.stringify(this.collection.pluck("id")),this.render())}.bind(this)),this.on("virtualdomrenderer:rendered",function(){this.children.forEach(function(e,t){e.remove(),delete this.children[t]}.bind(this)),this.rendered=$(this.template(this.templateData())),this.$el.html(this.rendered),this.rendered.find(".comments-view").each(function(e,t){this.children.push(new c({el:t,collectionId:$(t).data("shareid")}))}.bind(this))}),this.render()}}))({el:"#feeds .inner"}),new(Backbone.View.extend({template:_.template($("#task-template").text()),render:_.debounce(function(){this.$todoEl.html(""),this.collection.toJSON().filter(function(e){return 0===e.archived}).forEach(function(e){this.$todoEl.append(this.template({model:e}))}.bind(this)),$(".has-tooltip").tooltip()},17),collection:new Backbone.Collection,initialize:function(){this.$todoEl=$("#todo-el",this.$el),this.listenTo(this.collection,"all",this.render.bind(this))}}))({el:"#todos"})}).call(this);