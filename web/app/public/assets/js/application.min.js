(function(){angular.module("app",["angularMoment","nl2br"]).filter("currency",function(){function e(e){e=(e+"").replace(/[^0-9+\-Ee.]/g,"");var o=isFinite(+e)?+e:0,r=isFinite(+t)?Math.abs(t):0,i="undefined"==typeof a?",":a,l="undefined"==typeof n?".":n,c="",u=function(e,t){var n=Math.pow(10,t);return""+(Math.round(e*n)/n).toFixed(t)};return c=(r?u(o,r):""+Math.round(o)).split("."),c[0].length>3&&(c[0]=c[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,i)),(c[1]||"").length<r&&(c[1]=c[1]||"",c[1]+=new Array(r-c[1].length+1).join("0")),c.join(l)}var t=app_locale.decimal_places,n=app_locale.decimal_separator,a=(app_locale.currency_symbol,app_locale.symbol_location,app_locale.thousand_separator);return e})}).call(window),function(){angular.module("app").factory("collection",["$q","$http",function(e,t){function n(e){this.path=e}n.prototype.fetch=function(e){return t.get("/wall/feeds").then(function(e){return e.data})},n.prototype.get=function(e){return t.get("/wall/feed/"+e).then(function(e){return e.data})},n.prototype.create=function(e){return e.type="text",t.post("/wall/feed",e).then(function(e){return e.data})},n.prototype.update=function(e,n){return this.get(e).then(function(e){return e=angular.merge(e,n),t.put("/wall/feed/"+e.id,e)}).then(function(e){return e.data})},n.prototype["delete"]=function(e){return t["delete"]("/wall/feed/"+e)};var a={};return function(e){var t=(window.location.hostname+"-"+e).replace(/[\W_]+/g,"_");return a[t]||(a[t]=new n(t)),a[t]}}]).factory("WallFeeds",["collection",function(e){return e("wall-feeds")}]).filter("trustedHtml",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]).factory("Session",["$interval",function(e){var t=(localStorage.getItem("session"),{});return t}]).run(["$rootScope","Session",function(e,t){e.Session=t}]).directive("enterSubmit",function(){return{restrict:"A",link:function(e,t,n){t.bind("keydown",function(t){var a=t.keyCode||t.which;13===a&&t.shiftKey&&(t.preventDefault(),e.$apply(n.enterSubmit))})}}}).factory("User",function(){return user.params=function(){return{name:user.profile.first_name+" "+user.profile.last_name,id:user.id,avatar:user.profile.user_image}},user}).controller("WallController",["WallFeeds","$scope","User","Session","$timeout",function(e,t,n,a,o){Pusher.logToConsole=!1;var r=new Pusher("8ae2990cab38227cd212",{cluster:"ap1",encrypted:!0}),i=r.subscribe(window.location.host);i.bind("wall",function(e){switch(e.action){case"created":t.feeds.unshift(e.data);break;case"updated":var n=t.feeds.filter(function(t){return t.id==e.data.id}).pop();n?t.feeds.splice(t.feeds.indexOf(n),1,e.data):t.feeds.unshift(e.data);break;case"deleted":var n=t.feeds.filter(function(t){return t.id==e.id}).pop();n&&t.feeds.splice(t.feeds.indexOf(n),1)}o(function(){t.$digest()}),console.log(e)}),i.bind("wall-comments",function(e){console.log(e)}),t.feeds=[],t.length=10,e.fetch(t.length).then(function(e){e.forEach(function(e){t.feeds.push(e)})}),t.user=n,t.createFeed=function(){e.create({user:n.params(),content:t.comment,replies:[]}).then(function(e){t.comment=""})},t.doEditFeed=function(t,n){e.update(t.id,{content:n}),a.editComment=null},t.deleteFeed=function(t){confirm("Are you sure you want to delete this?")&&e["delete"](t.id)},t.createReply=function(e,a){var o=e.replies;o.push({user:n.params(),comment:a,createdAt:Date.now(),updatedAt:Date.now()}),e.put({replies:o,updatedAt:Date.now()}),t.reply=""},t.deleteReply=function(e,t){var n=e.replies.indexOf(t);n>-1&&confirm("Are you sure you want to delete this?")&&(e.replies.splice(n,1),e.put({replies:e.replies,updatedAt:Date.now()}))},t.doEditReply=function(e,t,n){var o=e.replies.indexOf(t);o>-1&&(t.comment=n,e.put({replies:e.replies,updatedAt:Date.now()})),a.editReply=null}}]).controller("SidebarController",["$scope","$http",function(e,t){e.entitlements={},t.get("/ajax/entitlement-balances").then(function(t){e.entitlements=t.data})}])}.call(window),function(){Dropzone.autoDiscover=!1,$(".click-once").click(function(e){var t=$(this);t.parents("form")[0].checkValidity()&&t.button("loading").val("Submitting...").text("Submitting...")}),window.init_datepicker=function(){window.app_locale&&$("input[data-type=date]").datetimepicker({format:app_locale.short_date})},init_datepicker(),$(".DT").length>0&&$(".DT").each(function(){var e=$(this);e.DataTable({ajax:"/data/"+e.data("path"),stateSave:!0,aaSorting:[]})})}.call(this);