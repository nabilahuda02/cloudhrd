(function(){$("#profile_contacts").duplicator({row:".row",remotes:{post:"/profile_contacts",put:"/profile_contacts","delete":"/profile_contacts",get:"/profile_contacts"}}),$("#profile_educations").duplicator({row:".row",remotes:{post:"/profile_educations",put:"/profile_educations","delete":"/profile_educations",get:"/profile_educations"}}),$("#profile_emergency").duplicator({row:".row",remotes:{post:"/profile_emergencies",put:"/profile_emergencies","delete":"/profile_emergencies",get:"/profile_emergencies"}}),$("#profile_employment").duplicator({row:".row",remotes:{post:"/profile_employment_history",put:"/profile_employment_history","delete":"/profile_employment_history",get:"/profile_employment_history"}}),$("#profile_family").duplicator({row:".row",remotes:{post:"/profile_family",put:"/profile_family","delete":"/profile_family",get:"/profile_family"}})}).call(this),function(e,t){var a=function(){function t(e,t,a){e.addEventListener?e.addEventListener(t,a,!1):e.attachEvent&&e.attachEvent("on"+t,a)}function n(a){var i=!1,n=function(){i||(i=!0,a())};document.write('<script defer src="//:" id="__onload_ie_pixastic__"></script>');var o=document.getElementById("__onload_ie_pixastic__");o.onreadystatechange=function(){"complete"==o.readyState&&(o.parentNode.removeChild(o),n())},document.addEventListener&&document.addEventListener("DOMContentLoaded",n,!1),t(e,"load",n)}function o(){for(var e=r("pixastic",null,"img"),t=r("pixastic",null,"canvas"),i=e.concat(t),n=0;n<i.length;n++)!function(){for(var e=i[n],t=[],o=e.className.split(" "),r=0;r<o.length;r++){var s=o[r];if("pixastic-"==s.substring(0,9)){var l=s.substring(9);""!=l&&t.push(l)}}if(t.length)if("img"==e.tagName.toLowerCase()){var c=new Image;if(c.src=e.src,c.complete)for(var h=0;h<t.length;h++){var d=a.applyAction(e,e,t[h],null);d&&(e=d)}else c.onload=function(){for(var i=0;i<t.length;i++){var n=a.applyAction(e,e,t[i],null);n&&(e=n)}}}else setTimeout(function(){for(var i=0;i<t.length;i++){var n=a.applyAction(e,e,t[i],null);n&&(e=n)}},1)}()}function r(e,t,a){var n=new Array;null==t&&(t=document),null==a&&(a="*");var o=t.getElementsByTagName(a),r=o.length,s=new RegExp("(^|\\s)"+e+"(\\s|$)");for(i=0,j=0;i<r;i++)s.test(o[i].className)&&(n[j]=o[i],j++);return n}function s(e,t){if(a.debug)try{switch(t){case"warn":console.warn("Pixastic:",e);break;case"error":console.error("Pixastic:",e);break;default:console.log("Pixastic:",e)}}catch(i){}}"undefined"!=typeof pixastic_parseonload&&pixastic_parseonload&&n(o);var l=function(){var e=document.createElement("canvas"),t=!1;try{t=!("function"!=typeof e.getContext||!e.getContext("2d"))}catch(a){}return function(){return t}}(),c=function(){var e,t=document.createElement("canvas"),a=!1;try{"function"==typeof t.getContext&&(e=t.getContext("2d"))&&(a="function"==typeof e.getImageData)}catch(i){}return function(){return a}}(),h=function(){var e=!1,t=document.createElement("canvas");if(l()&&c()){t.width=t.height=1;var a=t.getContext("2d");a.fillStyle="rgb(255,0,0)",a.fillRect(0,0,1,1);var i=document.createElement("canvas");i.width=i.height=1;var n=i.getContext("2d");n.fillStyle="rgb(0,0,255)",n.fillRect(0,0,1,1),a.globalAlpha=.5,a.drawImage(i,0,0);var o=a.getImageData(0,0,1,1).data;e=255!=o[2]}return function(){return e}}();return{parseOnLoad:!1,debug:!1,applyAction:function(e,t,i,n){n=n||{};var o="canvas"==e.tagName.toLowerCase();if(o&&a.Client.isIE())return a.debug&&s("Tried to process a canvas element but browser is IE."),!1;var r,l,c=!1;a.Client.hasCanvas()&&(c=!!n.resultCanvas,r=n.resultCanvas||document.createElement("canvas"),l=r.getContext("2d"));var h=e.offsetWidth,d=e.offsetHeight;if(o&&(h=e.width,d=e.height),0==h||0==d){if(null!=e.parentNode)return void(a.debug&&s("Image has 0 width and/or height."));var u=e.style.position,p=e.style.left;e.style.position="absolute",e.style.left="-9999px",document.body.appendChild(e),h=e.offsetWidth,d=e.offsetHeight,document.body.removeChild(e),e.style.position=u,e.style.left=p}if(i.indexOf("(")>-1){var f=i;i=f.substr(0,f.indexOf("("));var g=f.match(/\((.*?)\)/);if(g[1]){g=g[1].split(";");for(var v=0;v<g.length;v++)if(thisArg=g[v].split("="),2==thisArg.length)if("rect"==thisArg[0]){var m=thisArg[1].split(",");n[thisArg[0]]={left:parseInt(m[0],10)||0,top:parseInt(m[1],10)||0,width:parseInt(m[2],10)||0,height:parseInt(m[3],10)||0}}else n[thisArg[0]]=thisArg[1]}}n.rect?(n.rect.left=Math.round(n.rect.left),n.rect.top=Math.round(n.rect.top),n.rect.width=Math.round(n.rect.width),n.rect.height=Math.round(n.rect.height)):n.rect={left:0,top:0,width:h,height:d};var _=!1;if(a.Actions[i]&&"function"==typeof a.Actions[i].process&&(_=!0),!_)return a.debug&&s('Invalid action "'+i+'". Maybe file not included?'),!1;if(!a.Actions[i].checkSupport())return a.debug&&s('Action "'+i+'" not supported by this browser.'),!1;a.Client.hasCanvas()?(r!==e&&(r.width=h,r.height=d),c||(r.style.width=h+"px",r.style.height=d+"px"),l.drawImage(t,0,0,h,d),e.__pixastic_org_image?(r.__pixastic_org_image=e.__pixastic_org_image,r.__pixastic_org_width=e.__pixastic_org_width,r.__pixastic_org_height=e.__pixastic_org_height):(r.__pixastic_org_image=e,r.__pixastic_org_width=h,r.__pixastic_org_height=d)):a.Client.isIE()&&"undefined"==typeof e.__pixastic_org_style&&(e.__pixastic_org_style=e.style.cssText);var w={image:e,canvas:r,width:h,height:d,useData:!0,options:n},y=a.Actions[i].process(w);return y?a.Client.hasCanvas()?(w.useData&&a.Client.hasCanvasImageData()&&(r.getContext("2d").putImageData(w.canvasData,n.rect.left,n.rect.top),r.getContext("2d").fillRect(0,0,0,0)),n.leaveDOM||(r.title=e.title,r.imgsrc=e.imgsrc,o||(r.alt=e.alt),o||(r.imgsrc=e.src),r.className=e.className,r.style.cssText=e.style.cssText,r.name=e.name,r.tabIndex=e.tabIndex,r.id=e.id,e.parentNode&&e.parentNode.replaceChild&&e.parentNode.replaceChild(r,e)),n.resultCanvas=r,r):e:!1},prepareData:function(e,t){var a=e.canvas.getContext("2d"),i=e.options.rect,n=a.getImageData(i.left,i.top,i.width,i.height),o=n.data;return t||(e.canvasData=n),o},process:function(e,t,i,n){if("img"==e.tagName.toLowerCase()){var o=new Image;if(o.src=e.src,o.complete){var r=a.applyAction(e,o,t,i);return n&&n(r),r}o.onload=function(){var r=a.applyAction(e,o,t,i);n&&n(r)}}if("canvas"==e.tagName.toLowerCase()){var r=a.applyAction(e,e,t,i);return n&&n(r),r}},revert:function(e){if(a.Client.hasCanvas()){if("canvas"==e.tagName.toLowerCase()&&e.__pixastic_org_image)return e.width=e.__pixastic_org_width,e.height=e.__pixastic_org_height,e.getContext("2d").drawImage(e.__pixastic_org_image,0,0),e.parentNode&&e.parentNode.replaceChild&&e.parentNode.replaceChild(e.__pixastic_org_image,e),e}else a.Client.isIE()&&"undefined"!=typeof e.__pixastic_org_style&&(e.style.cssText=e.__pixastic_org_style)},Client:{hasCanvas:l,hasCanvasImageData:c,hasGlobalAlpha:h,isIE:function(){return!!document.all&&!!e.attachEvent&&!e.opera}},Actions:{}}}();"undefined"!=typeof jQuery&&jQuery&&jQuery.fn&&(jQuery.fn.pixastic=function(e,t){var i=[];return this.each(function(){if("img"!=this.tagName.toLowerCase()||this.complete){var n=a.process(this,e,t);n&&i.push(n)}}),i.length>0?jQuery(i):this}),a.Actions.crop={process:function(e){if(a.Client.hasCanvas()){var t=e.options.rect,i=t.width,n=t.height,o=t.top,r=t.left;"undefined"!=typeof e.options.left&&(r=parseInt(e.options.left,10)),"undefined"!=typeof e.options.top&&(o=parseInt(e.options.top,10)),"undefined"!=typeof e.options.height&&(i=parseInt(e.options.width,10)),"undefined"!=typeof e.options.height&&(n=parseInt(e.options.height,10)),0>r&&(r=0),r>e.width-1&&(r=e.width-1),0>o&&(o=0),o>e.height-1&&(o=e.height-1),1>i&&(i=1),r+i>e.width&&(i=e.width-r),1>n&&(n=1),o+n>e.height&&(n=e.height-o);var s=document.createElement("canvas");return s.width=e.width,s.height=e.height,s.getContext("2d").drawImage(e.canvas,0,0),e.canvas.width=i,e.canvas.height=n,e.canvas.getContext("2d").clearRect(0,0,i,n),e.canvas.getContext("2d").drawImage(s,r,o,i,n,0,0,i,n),e.useData=!1,!0}},checkSupport:function(){return a.Client.hasCanvas()}},a.Actions.rotate={process:function(e){if(a.Client.hasCanvas()){var t=e.canvas,i=e.width,n=e.height,o=document.createElement("canvas");o.width=i,o.height=n,o.getContext("2d").drawImage(t,0,0,i,n);var r=-parseFloat(e.options.angle)*Math.PI/180,s=r;s>.5*Math.PI&&(s=Math.PI-s),s<.5*-Math.PI&&(s=-Math.PI-s);var l=Math.sqrt(i*i+n*n),c=Math.abs(s)-Math.abs(Math.atan2(n,i)),h=Math.abs(s)+Math.abs(Math.atan2(n,i)),d=Math.abs(Math.cos(c)*l),u=Math.abs(Math.sin(h)*l);t.width=d,t.height=u;var p=t.getContext("2d");return p.translate(d/2,u/2),p.rotate(r),p.drawImage(o,-i/2,-n/2),e.useData=!1,!0}},checkSupport:function(){return a.Client.hasCanvas()}},function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?module.exports=e:e(jQuery)}(function(t){function a(a){var s=a||e.event,l=c.call(arguments,1),h=0,u=0,p=0,f=0,g=0,v=0;if(a=t.event.fix(s),a.type="mousewheel","detail"in s&&(p=-1*s.detail),"wheelDelta"in s&&(p=s.wheelDelta),"wheelDeltaY"in s&&(p=s.wheelDeltaY),"wheelDeltaX"in s&&(u=-1*s.wheelDeltaX),"axis"in s&&s.axis===s.HORIZONTAL_AXIS&&(u=-1*p,p=0),h=0===p?u:p,"deltaY"in s&&(p=-1*s.deltaY,h=p),"deltaX"in s&&(u=s.deltaX,0===p&&(h=-1*u)),0!==p||0!==u){if(1===s.deltaMode){var m=t.data(this,"mousewheel-line-height");h*=m,p*=m,u*=m}else if(2===s.deltaMode){var _=t.data(this,"mousewheel-page-height");h*=_,p*=_,u*=_}if(f=Math.max(Math.abs(p),Math.abs(u)),(!r||r>f)&&(r=f,n(s,f)&&(r/=40)),n(s,f)&&(h/=40,u/=40,p/=40),h=Math[h>=1?"floor":"ceil"](h/r),u=Math[u>=1?"floor":"ceil"](u/r),p=Math[p>=1?"floor":"ceil"](p/r),d.settings.normalizeOffset&&this.getBoundingClientRect){var w=this.getBoundingClientRect();g=a.clientX-w.left,v=a.clientY-w.top}return a.deltaX=u,a.deltaY=p,a.deltaFactor=r,a.offsetX=g,a.offsetY=v,a.deltaMode=0,l.unshift(a,h,u,p),o&&clearTimeout(o),o=setTimeout(i,200),(t.event.dispatch||t.event.handle).apply(this,l)}}function i(){r=null}function n(e,t){return d.settings.adjustOldDeltas&&"mousewheel"===e.type&&t%120===0}var o,r,s=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],l="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],c=Array.prototype.slice;if(t.event.fixHooks)for(var h=s.length;h;)t.event.fixHooks[s[--h]]=t.event.mouseHooks;var d=t.event.special.mousewheel={version:"3.1.11",setup:function(){if(this.addEventListener)for(var e=l.length;e;)this.addEventListener(l[--e],a,!1);else this.onmousewheel=a;t.data(this,"mousewheel-line-height",d.getLineHeight(this)),t.data(this,"mousewheel-page-height",d.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var e=l.length;e;)this.removeEventListener(l[--e],a,!1);else this.onmousewheel=null;t.removeData(this,"mousewheel-line-height"),t.removeData(this,"mousewheel-page-height")},getLineHeight:function(e){var a=t(e)["offsetParent"in t.fn?"offsetParent":"parent"]();return a.length||(a=t("body")),parseInt(a.css("fontSize"),10)},getPageHeight:function(e){return t(e).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};t.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})}),t.fn.drags=function(e){if(e=t.extend({handle:"",cursor:"move"},e),""===e.handle)var a=this;else var a=this.find(e.handle);return a.css("cursor",e.cursor).on("mousedown",function(a){if(""===e.handle)var i=t(this).addClass("draggable");else var i=t(this).addClass("active-handle").parent().addClass("draggable");var n=i.css("z-index"),o=i.outerHeight(),r=i.outerWidth(),s=i.offset().top+o-a.pageY,l=i.offset().left+r-a.pageX;i.css("z-index",1e3).parents().on("mousemove",function(e){t(".draggable").offset({top:e.pageY+s-o,left:e.pageX+l-r}).on("mouseup",function(){t(this).removeClass("draggable").css("z-index",n)})}),a.preventDefault()}).on("mouseup",function(){""===e.handle?t(this).removeClass("draggable"):t(this).removeClass("active-handle").parent().removeClass("draggable")})},t.fn.avatar=function(a){var i=t(this);i.on("ready",function(){var n,o,r,s,l=i.height(),c=i.width(),h=t('<input type="file" accept="image/*">'),d=t("<div></div>").css({position:"relative",overflow:"hidden",height:l,width:c}),u=t("<div></div>").css({position:"absolute",bottom:"0px",right:"0px",cursor:"pointer","z-index":1001}).hide(),p=function(t){for(var a=atob(t.split(",")[1]),i=t.split(",")[0].split(":")[1].split(";")[0],n=new ArrayBuffer(a.length),o=new Uint8Array(n),r=0;r<a.length;r++)o[r]=a.charCodeAt(r);var s=e.MozBlobBuilder||e.WebKitBlobBuilder||e.BlobBuilder;return s?(s=new s,s.append(n),s.getBlob(i)):new Blob([n],{type:i})},f=t("<button>&#10003;</button>").click(function(){var e={top:Math.abs(parseInt(n.css("top"),10))||1,left:Math.abs(parseInt(n.css("left"),10))||1,width:c,height:l};s=n.pixastic("crop",{rect:e}),s.css({top:"0px",left:"0px",width:c,height:l});var o=new FormData,r=s[0].toDataURL();t(s).remove(),n.remove(),i.attr("src",r).fadeIn(),o.append("file",p(r)),t.ajax({url:a,type:"POST",data:o,processData:!1,contentType:!1,success:function(e){u.fadeOut();try{h[0].value="",h[0].value&&(h[0].type="text",h[0].type="file")}catch(a){}setTimeout(function(){v.fadeIn(100),t.notify("Profile image updated","success")},2e3)},error:function(e,t,a){console.log(a)}})}),g=(t("<button>↻</button>").click(function(){u.angle||(u.angle=0),u.angle=u.angle+90,console.log(u.angle),n.pixastic("rotate",{angle:u.angle})}),t("<button>&times;</button>").click(function(){t(s).remove(),n.remove(),i.fadeIn(),u.fadeOut(),v.fadeIn(100);try{h[0].value="",h[0].value&&(h[0].type="text",h[0].type="file")}catch(e){}}));u.append(f),u.append(g);var v=t("<div>Click to change</div>").css({"background-color":"rgba(255,255,255,0.8)",height:l,width:c,"padding-top":"45%",position:"absolute",top:"0px",left:"0px",cursor:"pointer"}),m=t("<div>Use your mousewheel to zoom and drag to position your avatar. Click &#10003; once your are done.</div>").css({"background-color":"rgba(255,255,255,0.8)",height:l,width:c,"padding-top":"18%",position:"absolute",top:"0px",left:"0px",cursor:"pointer"}).hide().click(function(){m.fadeOut()});i.wrap(d),i.after(v),i.after(m),i.after(u),v.click(function(){h.click()}),h.on("change",function(a){this.files&&this.files[0]&&(v.hide(),i.fadeOut(),e.URL=e.URL||e.webkitURL,n=t(new Image).hide().mousewheel(function(e,a){var i=a>0?"+=50":"-=50";t(this).css("width",i),e.preventDefault(),e.stopImmediatePropagation()}).on("load",function(){n.show().width("auto").drags(),o=n.width(),r=n.height()}).attr("src",e.URL.createObjectURL(this.files[0])),i.after(n),m.fadeIn(),setTimeout(function(){m.fadeOut(),u.fadeIn()},3e3))})}),i.height()>0?i.trigger("ready"):i.on("load",function(){i.trigger("ready")})}}.call(this,window,jQuery),$("#profile_image").avatar("/ajax/upload-image");