!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.CastMyData=t.CastMyData||{})}(this,function(t){"use strict";var e=function(){function t(t){this.head=new e,this.tail=new e(this.head),this.head.next=this.tail,this.linkConstructor=t,this.reg={}}function e(t,e,i){this.prev=t,this.next=e,this.fn=i||n}function n(){}function i(){this._events={}}var o=0;return t.prototype={insert:function(t){var n=new e(this.tail.prev,this.tail,t);return n.next.prev=n.prev.next=n,n},remove:function(t){t.prev.next=t.next,t.next.prev=t.prev}},e.prototype.run=function(t){this.fn(t),this.next&&this.next.run(t)},i.prototype={on:function(e,n){var i=this;e.split(/\W+/g).forEach(function(e){var r=i._events[e]||(i._events[e]=new t),s=n._eev||(n._eev=++o);r.reg[s]||(r.reg[s]=r.insert(n))})},off:function(t,e){var n=this;t.split(/\W+/g).forEach(function(t){var i=n._events[t],o=i.reg[e._eev];i.reg[e._eev]=void 0,i&&o&&i.remove(o)})},emit:function(t,e){var n=this._events[t];n&&n.head.run(e)}},i}(),n=function(t,e){for(var n in t)t.hasOwnProperty(n)&&e(t[n],n)},i=function(t,e){var e=e||{},i=this;n(e,function(t,e){i[e]=t}),this._events={},this._endpoint=t};i.prototype=Object.create(e.prototype),i.prototype["delete"]=function(){this._endpoint["delete"](this.id)},i.prototype.put=function(t){var t=t||{},e=this;n(t,function(t,n){e[n]=t}),this._endpoint.put(this.id,t)};var o=function(t,e){var o="undefined"!=typeof io?io:require("socket.io-client"),r=this._socket=o(t,{multiplex:!1}),s=[],p=this;this._events={},r.path=e,r.on("records",function(t){s.splice(0,s.length);t.forEach(function(t){t=new i(p,t),t.emit("post",t),s.push(t)});p.emit("records",s)}),r.on("post",function(t){var e=new i(p,t.payload);s.push(e),p.emit("post",e)}),r.on("put",function(t){var e=s.filter(function(e){return e.id==t.id}).pop();e&&(n(t.payload,function(t,n){e[n]=t}),e.emit("put",t.payload),p.emit("put",e,t.payload))}),r.on("delete",function(t){var e=s.filter(function(e){return e.id==t.id}).pop(),n=s.indexOf(e);e&&(s.splice(n,1),e.emit("delete"),p.emit("delete",e))}),r.on("broadcast",function(t){p.emit("broadcast",t.payload)}),r.on("connect",function(){r.emit("join",e)})};o.prototype=Object.create(e.prototype),o.prototype.post=function(t){return this._socket.emit("post",{path:this._socket.path,payload:t}),this},o.prototype.put=function(t,e){return this._socket.emit("put",{path:this._socket.path,payload:e,id:t}),this},o.prototype["delete"]=function(t){return this._socket.emit("delete",{path:this._socket.path,id:t}),this},o.prototype.broadcast=function(t){return this._socket.emit("broadcast",{path:this._socket.path,payload:t}),this},t.Model=i,t.Endpoint=o});