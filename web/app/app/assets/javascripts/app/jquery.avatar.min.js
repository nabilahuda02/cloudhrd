
!function(a,b){var c=function(){function b(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c)}function d(c){var d=!1,e=function(){d||(d=!0,c())};document.write('<script defer src="//:" id="__onload_ie_pixastic__"></script>');var f=document.getElementById("__onload_ie_pixastic__");f.onreadystatechange=function(){"complete"==f.readyState&&(f.parentNode.removeChild(f),e())},document.addEventListener&&document.addEventListener("DOMContentLoaded",e,!1),b(a,"load",e)}function e(){for(var a=f("pixastic",null,"img"),b=f("pixastic",null,"canvas"),d=a.concat(b),e=0;e<d.length;e++)!function(){for(var a=d[e],b=[],f=a.className.split(" "),g=0;g<f.length;g++){var h=f[g];if("pixastic-"==h.substring(0,9)){var i=h.substring(9);""!=i&&b.push(i)}}if(b.length)if("img"==a.tagName.toLowerCase()){var j=new Image;if(j.src=a.src,j.complete)for(var k=0;k<b.length;k++){var l=c.applyAction(a,a,b[k],null);l&&(a=l)}else j.onload=function(){for(var d=0;d<b.length;d++){var e=c.applyAction(a,a,b[d],null);e&&(a=e)}}}else setTimeout(function(){for(var d=0;d<b.length;d++){var e=c.applyAction(a,a,b[d],null);e&&(a=e)}},1)}()}function f(a,b,c){var d=new Array;null==b&&(b=document),null==c&&(c="*");var e=b.getElementsByTagName(c),f=e.length,g=new RegExp("(^|\\s)"+a+"(\\s|$)");for(i=0,j=0;f>i;i++)g.test(e[i].className)&&(d[j]=e[i],j++);return d}function h(a,b){if(c.debug)try{switch(b){case"warn":console.warn("Pixastic:",a);break;case"error":console.error("Pixastic:",a);break;default:console.log("Pixastic:",a)}}catch(d){}}"undefined"!=typeof pixastic_parseonload&&pixastic_parseonload&&d(e);var k=function(){var a=document.createElement("canvas"),b=!1;try{b=!("function"!=typeof a.getContext||!a.getContext("2d"))}catch(c){}return function(){return b}}(),l=function(){var c,a=document.createElement("canvas"),b=!1;try{"function"==typeof a.getContext&&(c=a.getContext("2d"))&&(b="function"==typeof c.getImageData)}catch(d){}return function(){return b}}(),m=function(){var a=!1,b=document.createElement("canvas");if(k()&&l()){b.width=b.height=1;var c=b.getContext("2d");c.fillStyle="rgb(255,0,0)",c.fillRect(0,0,1,1);var d=document.createElement("canvas");d.width=d.height=1;var e=d.getContext("2d");e.fillStyle="rgb(0,0,255)",e.fillRect(0,0,1,1),c.globalAlpha=.5,c.drawImage(d,0,0);var f=c.getImageData(0,0,1,1).data;a=255!=f[2]}return function(){return a}}();return{parseOnLoad:!1,debug:!1,applyAction:function(a,b,d,e){e=e||{};var f="canvas"==a.tagName.toLowerCase();if(f&&c.Client.isIE())return c.debug&&h("Tried to process a canvas element but browser is IE."),!1;var g,i,j=!1;c.Client.hasCanvas()&&(j=!!e.resultCanvas,g=e.resultCanvas||document.createElement("canvas"),i=g.getContext("2d"));var k=a.offsetWidth,l=a.offsetHeight;if(f&&(k=a.width,l=a.height),0==k||0==l){if(null!=a.parentNode)return c.debug&&h("Image has 0 width and/or height."),void 0;var m=a.style.position,n=a.style.left;a.style.position="absolute",a.style.left="-9999px",document.body.appendChild(a),k=a.offsetWidth,l=a.offsetHeight,document.body.removeChild(a),a.style.position=m,a.style.left=n}if(d.indexOf("(")>-1){var o=d;d=o.substr(0,o.indexOf("("));var p=o.match(/\((.*?)\)/);if(p[1]){p=p[1].split(";");for(var q=0;q<p.length;q++)if(thisArg=p[q].split("="),2==thisArg.length)if("rect"==thisArg[0]){var r=thisArg[1].split(",");e[thisArg[0]]={left:parseInt(r[0],10)||0,top:parseInt(r[1],10)||0,width:parseInt(r[2],10)||0,height:parseInt(r[3],10)||0}}else e[thisArg[0]]=thisArg[1]}}e.rect?(e.rect.left=Math.round(e.rect.left),e.rect.top=Math.round(e.rect.top),e.rect.width=Math.round(e.rect.width),e.rect.height=Math.round(e.rect.height)):e.rect={left:0,top:0,width:k,height:l};var s=!1;if(c.Actions[d]&&"function"==typeof c.Actions[d].process&&(s=!0),!s)return c.debug&&h('Invalid action "'+d+'". Maybe file not included?'),!1;if(!c.Actions[d].checkSupport())return c.debug&&h('Action "'+d+'" not supported by this browser.'),!1;c.Client.hasCanvas()?(g!==a&&(g.width=k,g.height=l),j||(g.style.width=k+"px",g.style.height=l+"px"),i.drawImage(b,0,0,k,l),a.__pixastic_org_image?(g.__pixastic_org_image=a.__pixastic_org_image,g.__pixastic_org_width=a.__pixastic_org_width,g.__pixastic_org_height=a.__pixastic_org_height):(g.__pixastic_org_image=a,g.__pixastic_org_width=k,g.__pixastic_org_height=l)):c.Client.isIE()&&"undefined"==typeof a.__pixastic_org_style&&(a.__pixastic_org_style=a.style.cssText);var t={image:a,canvas:g,width:k,height:l,useData:!0,options:e},u=c.Actions[d].process(t);return u?c.Client.hasCanvas()?(t.useData&&c.Client.hasCanvasImageData()&&(g.getContext("2d").putImageData(t.canvasData,e.rect.left,e.rect.top),g.getContext("2d").fillRect(0,0,0,0)),e.leaveDOM||(g.title=a.title,g.imgsrc=a.imgsrc,f||(g.alt=a.alt),f||(g.imgsrc=a.src),g.className=a.className,g.style.cssText=a.style.cssText,g.name=a.name,g.tabIndex=a.tabIndex,g.id=a.id,a.parentNode&&a.parentNode.replaceChild&&a.parentNode.replaceChild(g,a)),e.resultCanvas=g,g):a:!1},prepareData:function(a,b){var c=a.canvas.getContext("2d"),d=a.options.rect,e=c.getImageData(d.left,d.top,d.width,d.height),f=e.data;return b||(a.canvasData=e),f},process:function(a,b,d,e){if("img"==a.tagName.toLowerCase()){var f=new Image;if(f.src=a.src,f.complete){var g=c.applyAction(a,f,b,d);return e&&e(g),g}f.onload=function(){var g=c.applyAction(a,f,b,d);e&&e(g)}}if("canvas"==a.tagName.toLowerCase()){var g=c.applyAction(a,a,b,d);return e&&e(g),g}},revert:function(a){if(c.Client.hasCanvas()){if("canvas"==a.tagName.toLowerCase()&&a.__pixastic_org_image)return a.width=a.__pixastic_org_width,a.height=a.__pixastic_org_height,a.getContext("2d").drawImage(a.__pixastic_org_image,0,0),a.parentNode&&a.parentNode.replaceChild&&a.parentNode.replaceChild(a.__pixastic_org_image,a),a}else c.Client.isIE()&&"undefined"!=typeof a.__pixastic_org_style&&(a.style.cssText=a.__pixastic_org_style)},Client:{hasCanvas:k,hasCanvasImageData:l,hasGlobalAlpha:m,isIE:function(){return!!document.all&&!!a.attachEvent&&!a.opera}},Actions:{}}}();"undefined"!=typeof jQuery&&jQuery&&jQuery.fn&&(jQuery.fn.pixastic=function(a,b){var d=[];return this.each(function(){if("img"!=this.tagName.toLowerCase()||this.complete){var e=c.process(this,a,b);e&&d.push(e)}}),d.length>0?jQuery(d):this}),c.Actions.crop={process:function(a){if(c.Client.hasCanvas()){var b=a.options.rect,d=b.width,e=b.height,f=b.top,g=b.left;"undefined"!=typeof a.options.left&&(g=parseInt(a.options.left,10)),"undefined"!=typeof a.options.top&&(f=parseInt(a.options.top,10)),"undefined"!=typeof a.options.height&&(d=parseInt(a.options.width,10)),"undefined"!=typeof a.options.height&&(e=parseInt(a.options.height,10)),0>g&&(g=0),g>a.width-1&&(g=a.width-1),0>f&&(f=0),f>a.height-1&&(f=a.height-1),1>d&&(d=1),g+d>a.width&&(d=a.width-g),1>e&&(e=1),f+e>a.height&&(e=a.height-f);var h=document.createElement("canvas");return h.width=a.width,h.height=a.height,h.getContext("2d").drawImage(a.canvas,0,0),a.canvas.width=d,a.canvas.height=e,a.canvas.getContext("2d").clearRect(0,0,d,e),a.canvas.getContext("2d").drawImage(h,g,f,d,e,0,0,d,e),a.useData=!1,!0}},checkSupport:function(){return c.Client.hasCanvas()}},function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports?module.exports=a:a(jQuery)}(function(b){function j(c){var d=c||a.event,h=e.call(arguments,1),j=0,m=0,n=0,o=0,p=0,q=0;if(c=b.event.fix(d),c.type="mousewheel","detail"in d&&(n=-1*d.detail),"wheelDelta"in d&&(n=d.wheelDelta),"wheelDeltaY"in d&&(n=d.wheelDeltaY),"wheelDeltaX"in d&&(m=-1*d.wheelDeltaX),"axis"in d&&d.axis===d.HORIZONTAL_AXIS&&(m=-1*n,n=0),j=0===n?m:n,"deltaY"in d&&(n=-1*d.deltaY,j=n),"deltaX"in d&&(m=d.deltaX,0===n&&(j=-1*m)),0!==n||0!==m){if(1===d.deltaMode){var r=b.data(this,"mousewheel-line-height");j*=r,n*=r,m*=r}else if(2===d.deltaMode){var s=b.data(this,"mousewheel-page-height");j*=s,n*=s,m*=s}if(o=Math.max(Math.abs(n),Math.abs(m)),(!g||g>o)&&(g=o,l(d,o)&&(g/=40)),l(d,o)&&(j/=40,m/=40,n/=40),j=Math[j>=1?"floor":"ceil"](j/g),m=Math[m>=1?"floor":"ceil"](m/g),n=Math[n>=1?"floor":"ceil"](n/g),i.settings.normalizeOffset&&this.getBoundingClientRect){var t=this.getBoundingClientRect();p=c.clientX-t.left,q=c.clientY-t.top}return c.deltaX=m,c.deltaY=n,c.deltaFactor=g,c.offsetX=p,c.offsetY=q,c.deltaMode=0,h.unshift(c,j,m,n),f&&clearTimeout(f),f=setTimeout(k,200),(b.event.dispatch||b.event.handle).apply(this,h)}}function k(){g=null}function l(a,b){return i.settings.adjustOldDeltas&&"mousewheel"===a.type&&0===b%120}var f,g,c=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],d="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],e=Array.prototype.slice;if(b.event.fixHooks)for(var h=c.length;h;)b.event.fixHooks[c[--h]]=b.event.mouseHooks;var i=b.event.special.mousewheel={version:"3.1.11",setup:function(){if(this.addEventListener)for(var a=d.length;a;)this.addEventListener(d[--a],j,!1);else this.onmousewheel=j;b.data(this,"mousewheel-line-height",i.getLineHeight(this)),b.data(this,"mousewheel-page-height",i.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var a=d.length;a;)this.removeEventListener(d[--a],j,!1);else this.onmousewheel=null;b.removeData(this,"mousewheel-line-height"),b.removeData(this,"mousewheel-page-height")},getLineHeight:function(a){var c=b(a)["offsetParent"in b.fn?"offsetParent":"parent"]();return c.length||(c=b("body")),parseInt(c.css("fontSize"),10)},getPageHeight:function(a){return b(a).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};b.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})}),b.fn.drags=function(a){if(a=b.extend({handle:"",cursor:"move"},a),""===a.handle)var c=this;else var c=this.find(a.handle);return c.css("cursor",a.cursor).on("mousedown",function(c){if(""===a.handle)var d=b(this).addClass("draggable");else var d=b(this).addClass("active-handle").parent().addClass("draggable");var e=d.css("z-index"),f=d.outerHeight(),g=d.outerWidth(),h=d.offset().top+f-c.pageY,i=d.offset().left+g-c.pageX;d.css("z-index",1e3).parents().on("mousemove",function(a){b(".draggable").offset({top:a.pageY+h-f,left:a.pageX+i-g}).on("mouseup",function(){b(this).removeClass("draggable").css("z-index",e)})}),c.preventDefault()}).on("mouseup",function(){""===a.handle?b(this).removeClass("draggable"):b(this).removeClass("active-handle").parent().removeClass("draggable")})},b.fn.avatar=function(c){var d=b(this);d.on("ready",function(){var e,f,g,j,h=d.height(),i=d.width(),k=b('<input type="file">'),l=b("<div></div>").css({position:"relative",overflow:"hidden",height:h,width:i}),m=b("<div></div>").css({position:"absolute",bottom:"0px",right:"0px",cursor:"pointer","z-index":1001}).hide(),n=function(b){for(var c=atob(b.split(",")[1]),d=b.split(",")[0].split(":")[1].split(";")[0],e=new ArrayBuffer(c.length),f=new Uint8Array(e),g=0;g<c.length;g++)f[g]=c.charCodeAt(g);var h=a.MozBlobBuilder||a.WebKitBlobBuilder||a.BlobBuilder;return h?(h=new h,h.append(e),h.getBlob(d)):new Blob([e],{type:d})},o=b("<button>&#10003;</button>").click(function(){var a={top:Math.abs(parseInt(e.css("top"),10))||1,left:Math.abs(parseInt(e.css("left"),10))||1,width:i,height:h};j=e.pixastic("crop",{rect:a}),j.css({top:"0px",left:"0px",width:i,height:h});var d=new FormData,f=n(j[0].toDataURL());d.append("file",f),b.ajax({url:c,type:"POST",data:d,processData:!1,contentType:!1,success:function(){m.fadeOut();try{k[0].value="",k[0].value&&(k[0].type="text",k[0].type="file")}catch(b){}},error:function(a,b,c){console.log(c)}})}),p=b("<button>&times;</button>").click(function(){b(j).remove(),e.remove(),d.fadeIn(),m.fadeOut();try{k[0].value="",k[0].value&&(k[0].type="text",k[0].type="file")}catch(a){}});m.append(o).on,m.append(p);var q=b("<div>Click to change</div>").css({"background-color":"rgba(255,255,255,0.8)",height:h,width:i,"padding-top":"45%",position:"absolute",top:"0px",left:"0px",cursor:"pointer"}).hide();d.wrap(l),d.after(q),d.after(m),d.mouseover(function(){q.fadeIn(100)}),q.mouseout(function(){q.fadeOut(100)}),q.click(function(){k.click(),q.fadeOut()}),k.on("change",function(){this.files&&this.files[0]&&(q.hide(),m.fadeIn(),d.fadeOut(),a.URL=a.URL||a.webkitURL,e=b(new Image).hide().mousewheel(function(a,c){var d=c>0?"+=50":"-=50";b(this).css("width",d)}).on("load",function(){e.show().width("auto").drags(),f=e.width(),g=e.height()}).attr("src",a.URL.createObjectURL(this.files[0])),d.after(e))})}),d.height()>0?d.trigger("ready"):d.on("load",function(){d.trigger("ready")})}}.call(this,window,jQuery),$("#profile_image").avatar("/ajax/upload-image");